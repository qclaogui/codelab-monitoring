name: Release Drafter

on:
  push:
    # branches to consider in the event; optional, defaults to all
    branches:
      - main
  workflow_dispatch: {} # Allow manual triggering

jobs:
  update_release_draft:
    runs-on: ubuntu-latest
    steps:
      - 
        name: Get App[bot] Token
        uses: actions/create-github-app-token@v2
        id: app-token
        with:
          app-id: ${{ vars.APP_ID }}
          private-key: ${{ secrets.PRIVATE_KEY }}
      - 
        name: Drafts your next Release notes
        uses: release-drafter/release-drafter@v6
        id: draft
        env:
          GITHUB_TOKEN: ${{ steps.app-token.outputs.token }}
        with:
          commitish: main
      - 
        name: Checkout
        uses: actions/checkout@0c366fd6a839edf440554fa01a7085ccba70ac98 #v4.2.2
        with:
          persist-credentials: false
      - 
        name: Copy release notes from Draft
        run: |
          tag_name=${STEPS_DRAFT_OUTPUTS_TAG_NAME}
          echo "${STEPS_DRAFT_OUTPUTS_BODY}" > docs/release_notes/${tag_name:1}.md
        env:
          STEPS_DRAFT_OUTPUTS_TAG_NAME: ${{ steps.draft.outputs.tag_name }}
          STEPS_DRAFT_OUTPUTS_BODY: ${{ steps.draft.outputs.body }}
      - 
        name: Upsert Pull Request
        uses: peter-evans/create-pull-request@98357b18bf14b5342f975ff684046ec3b2a07725 #v8.0.0
        with:
          token: ${{ steps.app-token.outputs.token }}
          title: Add release notes for ${{ steps.draft.outputs.tag_name }}
          commit-message: Add release notes for ${{ steps.draft.outputs.tag_name }}
          committer: ðŸ¤–QC Owl App[bot] <165384878+qc-owl-app[bot]@users.noreply.github.com>
          signoff: true
          # assignees: qclaogui
          # reviewers: qclaogui
          body: |
            ðŸ¤– Copy release notes from Draft

            <details>
            <summary> Full draft release notes for ${{ steps.draft.outputs.tag_name }} </summary>
            <blockquote>

            ${{ steps.draft.outputs.body }}
            
            </blockquote>
            </details>
            <br />

            > Auto-generated by [.github/workflows/release-drafter.yml][0]

            [0]: https://github.com/qclaogui/codelab-monitoring/blob/main/.github/workflows/release-drafter.yml
          labels: kind/docs, skip-release-notes
          branch: update-release-notes
          draft: true
