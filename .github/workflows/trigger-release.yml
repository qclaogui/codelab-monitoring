name: Trigger Release (Manually)

# https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#onworkflow_dispatchinputs
on:
  workflow_dispatch:
    inputs:
      release:
        description: 'Push tag and open PR to default branch'
        required: true
        default: 'prepare-release-candidate'
        type: choice
        options:
          - prepare-release
          - prepare-release-candidate

jobs:
  prepare_release:
    name: Trigger a ${{ inputs.release }} job
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 #v4.1.1
        with:
          token: ${{ secrets.QCBOT_TOKEN }}
          # Set fetch-depth: 0 to fetch all history for all branches and tags.
          fetch-depth: 0
      - uses: actions/setup-go@v5
        with:
          go-version: '1.23'
      - name: Setup identity
        uses: ./.github/actions/setup-identity
        with:
          token: ${{ secrets.QCBOT_TOKEN }}

      - run: make ${{ inputs.release }}
