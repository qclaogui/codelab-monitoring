apiVersion: v1
kind: Namespace
metadata:
  name: memcached-system
---
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  labels:
    app.kubernetes.io/instance: memcached
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: memcached
    app.kubernetes.io/version: 1.6.29
    helm.sh/chart: memcached-7.4.11
  name: memcached
  namespace: memcached-system
---
apiVersion: v1
data:
  memcached-overview.json: |-
    {
          "annotations": {
             "list": [ ]
          },
          "editable": true,
          "gnetId": null,
          "graphTooltip": 1,
          "hideControls": false,
          "links": [ ],
          "refresh": "10s",
          "rows": [
             {
                "collapse": false,
                "height": "250px",
                "panels": [
                   {
                      "aliasColors": { },
                      "bars": false,
                      "dashLength": 10,
                      "dashes": false,
                      "datasource": "$datasource",
                      "fill": 1,
                      "id": 1,
                      "legend": {
                         "avg": false,
                         "current": false,
                         "max": false,
                         "min": false,
                         "show": true,
                         "total": false,
                         "values": false
                      },
                      "lines": true,
                      "linewidth": 1,
                      "links": [ ],
                      "nullPointMode": "null as zero",
                      "percentage": false,
                      "pointradius": 5,
                      "points": false,
                      "renderer": "flot",
                      "seriesOverrides": [ ],
                      "spaceLength": 10,
                      "span": 6,
                      "stack": false,
                      "steppedLine": false,
                      "targets": [
                         {
                            "expr": "sum(rate(memcached_commands_total{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\", command=\"get\", status=\"hit\"}[$__rate_interval])) / sum(rate(memcached_commands_total{cluster=~\"$cluster\", job=~\"$job\", command=\"get\"}[$__rate_interval]))",
                            "format": "time_series",
                            "legendFormat": "Hit Rate",
                            "legendLink": null
                         }
                      ],
                      "thresholds": [ ],
                      "timeFrom": null,
                      "timeShift": null,
                      "title": "Hit Rate",
                      "tooltip": {
                         "shared": true,
                         "sort": 2,
                         "value_type": "individual"
                      },
                      "type": "graph",
                      "xaxis": {
                         "buckets": null,
                         "mode": "time",
                         "name": null,
                         "show": true,
                         "values": [ ]
                      },
                      "yaxes": [
                         {
                            "format": "percentunit",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": 0,
                            "show": true
                         },
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": null,
                            "show": false
                         }
                      ]
                   },
                   {
                      "aliasColors": { },
                      "bars": false,
                      "dashLength": 10,
                      "dashes": false,
                      "datasource": "$datasource",
                      "fill": 1,
                      "id": 2,
                      "legend": {
                         "avg": false,
                         "current": false,
                         "max": false,
                         "min": false,
                         "show": true,
                         "total": false,
                         "values": false
                      },
                      "lines": true,
                      "linewidth": 1,
                      "links": [ ],
                      "nullPointMode": "null as zero",
                      "percentage": false,
                      "pointradius": 5,
                      "points": false,
                      "renderer": "flot",
                      "seriesOverrides": [ ],
                      "spaceLength": 10,
                      "span": 6,
                      "stack": false,
                      "steppedLine": false,
                      "targets": [
                         {
                            "expr": "topk(20,\n  max by (cluster, job, instance) (\n    memcached_current_connections{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\"} / memcached_max_connections{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\"}\n))\n",
                            "format": "time_series",
                            "legendFormat": "{{ cluster }} / {{ job }} / {{ instance }}",
                            "legendLink": null
                         }
                      ],
                      "thresholds": [ ],
                      "timeFrom": null,
                      "timeShift": null,
                      "title": "Top 20 Highest Connection Usage",
                      "tooltip": {
                         "shared": true,
                         "sort": 2,
                         "value_type": "individual"
                      },
                      "type": "graph",
                      "xaxis": {
                         "buckets": null,
                         "mode": "time",
                         "name": null,
                         "show": true,
                         "values": [ ]
                      },
                      "yaxes": [
                         {
                            "format": "percentunit",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": 0,
                            "show": true
                         },
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": null,
                            "show": false
                         }
                      ]
                   }
                ],
                "repeat": null,
                "repeatIteration": null,
                "repeatRowId": null,
                "showTitle": true,
                "title": "Hits",
                "titleSize": "h6"
             },
             {
                "collapse": false,
                "height": "250px",
                "panels": [
                   {
                      "aliasColors": { },
                      "bars": false,
                      "dashLength": 10,
                      "dashes": false,
                      "datasource": "$datasource",
                      "fill": 1,
                      "id": 3,
                      "legend": {
                         "avg": false,
                         "current": false,
                         "max": false,
                         "min": false,
                         "show": true,
                         "total": false,
                         "values": false
                      },
                      "lines": true,
                      "linewidth": 1,
                      "links": [ ],
                      "nullPointMode": "null as zero",
                      "percentage": false,
                      "pointradius": 5,
                      "points": false,
                      "renderer": "flot",
                      "seriesOverrides": [ ],
                      "spaceLength": 10,
                      "span": 4,
                      "stack": false,
                      "steppedLine": false,
                      "targets": [
                         {
                            "expr": "sum by(command, status) (rate(memcached_commands_total{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\"}[$__rate_interval]))",
                            "format": "time_series",
                            "legendFormat": "{{command}} {{status}}",
                            "legendLink": null
                         }
                      ],
                      "thresholds": [ ],
                      "timeFrom": null,
                      "timeShift": null,
                      "title": "Commands",
                      "tooltip": {
                         "shared": true,
                         "sort": 2,
                         "value_type": "individual"
                      },
                      "type": "graph",
                      "xaxis": {
                         "buckets": null,
                         "mode": "time",
                         "name": null,
                         "show": true,
                         "values": [ ]
                      },
                      "yaxes": [
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": 0,
                            "show": true
                         },
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": null,
                            "show": false
                         }
                      ]
                   },
                   {
                      "aliasColors": { },
                      "bars": false,
                      "dashLength": 10,
                      "dashes": false,
                      "datasource": "$datasource",
                      "fill": 1,
                      "id": 4,
                      "legend": {
                         "avg": false,
                         "current": false,
                         "max": false,
                         "min": false,
                         "show": true,
                         "total": false,
                         "values": false
                      },
                      "lines": true,
                      "linewidth": 1,
                      "links": [ ],
                      "nullPointMode": "null as zero",
                      "percentage": false,
                      "pointradius": 5,
                      "points": false,
                      "renderer": "flot",
                      "seriesOverrides": [ ],
                      "spaceLength": 10,
                      "span": 4,
                      "stack": false,
                      "steppedLine": false,
                      "targets": [
                         {
                            "expr": "sum by(instance) (rate(memcached_items_evicted_total{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\"}[$__rate_interval]))",
                            "format": "time_series",
                            "legendFormat": "{{instance}}",
                            "legendLink": null
                         }
                      ],
                      "thresholds": [ ],
                      "timeFrom": null,
                      "timeShift": null,
                      "title": "Evictions",
                      "tooltip": {
                         "shared": true,
                         "sort": 2,
                         "value_type": "individual"
                      },
                      "type": "graph",
                      "xaxis": {
                         "buckets": null,
                         "mode": "time",
                         "name": null,
                         "show": true,
                         "values": [ ]
                      },
                      "yaxes": [
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": 0,
                            "show": true
                         },
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": null,
                            "show": false
                         }
                      ]
                   },
                   {
                      "aliasColors": { },
                      "bars": false,
                      "dashLength": 10,
                      "dashes": false,
                      "datasource": "$datasource",
                      "fill": 1,
                      "id": 5,
                      "legend": {
                         "avg": false,
                         "current": false,
                         "max": false,
                         "min": false,
                         "show": true,
                         "total": false,
                         "values": false
                      },
                      "lines": true,
                      "linewidth": 1,
                      "links": [ ],
                      "nullPointMode": "null as zero",
                      "percentage": false,
                      "pointradius": 5,
                      "points": false,
                      "renderer": "flot",
                      "seriesOverrides": [ ],
                      "spaceLength": 10,
                      "span": 4,
                      "stack": false,
                      "steppedLine": false,
                      "targets": [
                         {
                            "expr": "sum by(instance) (rate(memcached_items_total{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\"}[$__rate_interval]))",
                            "format": "time_series",
                            "legendFormat": "{{instance}}",
                            "legendLink": null
                         }
                      ],
                      "thresholds": [ ],
                      "timeFrom": null,
                      "timeShift": null,
                      "title": "Stored",
                      "tooltip": {
                         "shared": true,
                         "sort": 2,
                         "value_type": "individual"
                      },
                      "type": "graph",
                      "xaxis": {
                         "buckets": null,
                         "mode": "time",
                         "name": null,
                         "show": true,
                         "values": [ ]
                      },
                      "yaxes": [
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": 0,
                            "show": true
                         },
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": null,
                            "show": false
                         }
                      ]
                   }
                ],
                "repeat": null,
                "repeatIteration": null,
                "repeatRowId": null,
                "showTitle": true,
                "title": "Ops",
                "titleSize": "h6"
             },
             {
                "collapse": false,
                "height": "250px",
                "panels": [
                   {
                      "aliasColors": { },
                      "bars": false,
                      "dashLength": 10,
                      "dashes": false,
                      "datasource": "$datasource",
                      "fill": 10,
                      "id": 6,
                      "legend": {
                         "avg": false,
                         "current": false,
                         "max": false,
                         "min": false,
                         "show": true,
                         "total": false,
                         "values": false
                      },
                      "lines": true,
                      "linewidth": 0,
                      "links": [ ],
                      "nullPointMode": "null as zero",
                      "percentage": false,
                      "pointradius": 5,
                      "points": false,
                      "renderer": "flot",
                      "seriesOverrides": [ ],
                      "spaceLength": 10,
                      "span": 4,
                      "stack": true,
                      "steppedLine": false,
                      "targets": [
                         {
                            "expr": "sum by (instance) (\n  rate(memcached_process_user_cpu_seconds_total{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\"}[$__rate_interval]) +\n  rate(memcached_process_system_cpu_seconds_total{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])\n)\n",
                            "format": "time_series",
                            "legendFormat": "{{instance}}",
                            "legendLink": null
                         }
                      ],
                      "thresholds": [ ],
                      "timeFrom": null,
                      "timeShift": null,
                      "title": "CPU",
                      "tooltip": {
                         "shared": true,
                         "sort": 2,
                         "value_type": "individual"
                      },
                      "type": "graph",
                      "xaxis": {
                         "buckets": null,
                         "mode": "time",
                         "name": null,
                         "show": true,
                         "values": [ ]
                      },
                      "yaxes": [
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": 0,
                            "show": true
                         },
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": null,
                            "show": false
                         }
                      ]
                   },
                   {
                      "aliasColors": { },
                      "bars": false,
                      "dashLength": 10,
                      "dashes": false,
                      "datasource": "$datasource",
                      "fill": 10,
                      "id": 7,
                      "legend": {
                         "avg": false,
                         "current": false,
                         "max": false,
                         "min": false,
                         "show": true,
                         "total": false,
                         "values": false
                      },
                      "lines": true,
                      "linewidth": 0,
                      "links": [ ],
                      "nullPointMode": "null as zero",
                      "percentage": false,
                      "pointradius": 5,
                      "points": false,
                      "renderer": "flot",
                      "seriesOverrides": [ ],
                      "spaceLength": 10,
                      "span": 4,
                      "stack": true,
                      "steppedLine": false,
                      "targets": [
                         {
                            "expr": "sum by(instance) (memcached_current_bytes{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\"})",
                            "format": "time_series",
                            "legendFormat": "{{instance}}",
                            "legendLink": null
                         }
                      ],
                      "thresholds": [ ],
                      "timeFrom": null,
                      "timeShift": null,
                      "title": "Memory",
                      "tooltip": {
                         "shared": true,
                         "sort": 2,
                         "value_type": "individual"
                      },
                      "type": "graph",
                      "xaxis": {
                         "buckets": null,
                         "mode": "time",
                         "name": null,
                         "show": true,
                         "values": [ ]
                      },
                      "yaxes": [
                         {
                            "format": "bytes",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": 0,
                            "show": true
                         },
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": null,
                            "show": false
                         }
                      ]
                   },
                   {
                      "aliasColors": { },
                      "bars": false,
                      "dashLength": 10,
                      "dashes": false,
                      "datasource": "$datasource",
                      "fill": 10,
                      "id": 8,
                      "legend": {
                         "avg": false,
                         "current": false,
                         "max": false,
                         "min": false,
                         "show": true,
                         "total": false,
                         "values": false
                      },
                      "lines": true,
                      "linewidth": 0,
                      "links": [ ],
                      "nullPointMode": "null as zero",
                      "percentage": false,
                      "pointradius": 5,
                      "points": false,
                      "renderer": "flot",
                      "seriesOverrides": [ ],
                      "spaceLength": 10,
                      "span": 4,
                      "stack": true,
                      "steppedLine": false,
                      "targets": [
                         {
                            "expr": "sum by(instance) (memcached_current_items{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\"})",
                            "format": "time_series",
                            "legendFormat": "{{instance}}",
                            "legendLink": null
                         }
                      ],
                      "thresholds": [ ],
                      "timeFrom": null,
                      "timeShift": null,
                      "title": "Items",
                      "tooltip": {
                         "shared": true,
                         "sort": 2,
                         "value_type": "individual"
                      },
                      "type": "graph",
                      "xaxis": {
                         "buckets": null,
                         "mode": "time",
                         "name": null,
                         "show": true,
                         "values": [ ]
                      },
                      "yaxes": [
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": 0,
                            "show": true
                         },
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": null,
                            "show": false
                         }
                      ]
                   }
                ],
                "repeat": null,
                "repeatIteration": null,
                "repeatRowId": null,
                "showTitle": true,
                "title": "Resources",
                "titleSize": "h6"
             },
             {
                "collapse": false,
                "height": "250px",
                "panels": [
                   {
                      "aliasColors": { },
                      "bars": false,
                      "dashLength": 10,
                      "dashes": false,
                      "datasource": "$datasource",
                      "fill": 1,
                      "id": 9,
                      "legend": {
                         "avg": false,
                         "current": false,
                         "max": false,
                         "min": false,
                         "show": true,
                         "total": false,
                         "values": false
                      },
                      "lines": true,
                      "linewidth": 1,
                      "links": [ ],
                      "nullPointMode": "null as zero",
                      "percentage": false,
                      "pointradius": 5,
                      "points": false,
                      "renderer": "flot",
                      "seriesOverrides": [ ],
                      "spaceLength": 10,
                      "span": 3,
                      "stack": false,
                      "steppedLine": false,
                      "targets": [
                         {
                            "expr": "sum by(instance) (memcached_current_connections{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\"})",
                            "format": "time_series",
                            "legendFormat": "{{instance}}",
                            "legendLink": null
                         },
                         {
                            "expr": "min(memcached_max_connections{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\"})",
                            "format": "time_series",
                            "legendFormat": "Max Connections (min setting across all instances)",
                            "legendLink": null
                         }
                      ],
                      "thresholds": [ ],
                      "timeFrom": null,
                      "timeShift": null,
                      "title": "Current Connections",
                      "tooltip": {
                         "shared": true,
                         "sort": 2,
                         "value_type": "individual"
                      },
                      "type": "graph",
                      "xaxis": {
                         "buckets": null,
                         "mode": "time",
                         "name": null,
                         "show": true,
                         "values": [ ]
                      },
                      "yaxes": [
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": 0,
                            "show": true
                         },
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": null,
                            "show": false
                         }
                      ]
                   },
                   {
                      "aliasColors": { },
                      "bars": false,
                      "dashLength": 10,
                      "dashes": false,
                      "datasource": "$datasource",
                      "fill": 1,
                      "id": 10,
                      "legend": {
                         "avg": false,
                         "current": false,
                         "max": false,
                         "min": false,
                         "show": true,
                         "total": false,
                         "values": false
                      },
                      "lines": true,
                      "linewidth": 1,
                      "links": [ ],
                      "nullPointMode": "null as zero",
                      "percentage": false,
                      "pointradius": 5,
                      "points": false,
                      "renderer": "flot",
                      "seriesOverrides": [ ],
                      "spaceLength": 10,
                      "span": 3,
                      "stack": false,
                      "steppedLine": false,
                      "targets": [
                         {
                            "expr": "sum by(instance) (rate(memcached_connections_total{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\"}[$__rate_interval]))",
                            "format": "time_series",
                            "legendFormat": "{{instance}}",
                            "legendLink": null
                         }
                      ],
                      "thresholds": [ ],
                      "timeFrom": null,
                      "timeShift": null,
                      "title": "Connections / sec",
                      "tooltip": {
                         "shared": true,
                         "sort": 2,
                         "value_type": "individual"
                      },
                      "type": "graph",
                      "xaxis": {
                         "buckets": null,
                         "mode": "time",
                         "name": null,
                         "show": true,
                         "values": [ ]
                      },
                      "yaxes": [
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": 0,
                            "show": true
                         },
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": null,
                            "show": false
                         }
                      ]
                   },
                   {
                      "aliasColors": { },
                      "bars": false,
                      "dashLength": 10,
                      "dashes": false,
                      "datasource": "$datasource",
                      "fill": 1,
                      "id": 11,
                      "legend": {
                         "avg": false,
                         "current": false,
                         "max": false,
                         "min": false,
                         "show": true,
                         "total": false,
                         "values": false
                      },
                      "lines": true,
                      "linewidth": 1,
                      "links": [ ],
                      "nullPointMode": "null as zero",
                      "percentage": false,
                      "pointradius": 5,
                      "points": false,
                      "renderer": "flot",
                      "seriesOverrides": [ ],
                      "spaceLength": 10,
                      "span": 3,
                      "stack": false,
                      "steppedLine": false,
                      "targets": [
                         {
                            "expr": "sum by(instance) (rate(memcached_read_bytes_total{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\"}[$__rate_interval]))",
                            "format": "time_series",
                            "legendFormat": "{{instance}}",
                            "legendLink": null
                         }
                      ],
                      "thresholds": [ ],
                      "timeFrom": null,
                      "timeShift": null,
                      "title": "Bytes received",
                      "tooltip": {
                         "shared": true,
                         "sort": 2,
                         "value_type": "individual"
                      },
                      "type": "graph",
                      "xaxis": {
                         "buckets": null,
                         "mode": "time",
                         "name": null,
                         "show": true,
                         "values": [ ]
                      },
                      "yaxes": [
                         {
                            "format": "Bps",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": 0,
                            "show": true
                         },
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": null,
                            "show": false
                         }
                      ]
                   },
                   {
                      "aliasColors": { },
                      "bars": false,
                      "dashLength": 10,
                      "dashes": false,
                      "datasource": "$datasource",
                      "fill": 1,
                      "id": 12,
                      "legend": {
                         "avg": false,
                         "current": false,
                         "max": false,
                         "min": false,
                         "show": true,
                         "total": false,
                         "values": false
                      },
                      "lines": true,
                      "linewidth": 1,
                      "links": [ ],
                      "nullPointMode": "null as zero",
                      "percentage": false,
                      "pointradius": 5,
                      "points": false,
                      "renderer": "flot",
                      "seriesOverrides": [ ],
                      "spaceLength": 10,
                      "span": 3,
                      "stack": false,
                      "steppedLine": false,
                      "targets": [
                         {
                            "expr": "sum by(instance) (rate(memcached_written_bytes_total{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\"}[$__rate_interval]))",
                            "format": "time_series",
                            "legendFormat": "{{instance}}",
                            "legendLink": null
                         }
                      ],
                      "thresholds": [ ],
                      "timeFrom": null,
                      "timeShift": null,
                      "title": "Bytes transmitted",
                      "tooltip": {
                         "shared": true,
                         "sort": 2,
                         "value_type": "individual"
                      },
                      "type": "graph",
                      "xaxis": {
                         "buckets": null,
                         "mode": "time",
                         "name": null,
                         "show": true,
                         "values": [ ]
                      },
                      "yaxes": [
                         {
                            "format": "Bps",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": 0,
                            "show": true
                         },
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": null,
                            "show": false
                         }
                      ]
                   }
                ],
                "repeat": null,
                "repeatIteration": null,
                "repeatRowId": null,
                "showTitle": true,
                "title": "Network",
                "titleSize": "h6"
             },
             {
                "collapse": false,
                "height": "250px",
                "panels": [
                   {
                      "aliasColors": { },
                      "bars": false,
                      "dashLength": 10,
                      "dashes": false,
                      "datasource": "$datasource",
                      "fill": 1,
                      "id": 13,
                      "legend": {
                         "avg": false,
                         "current": false,
                         "max": false,
                         "min": false,
                         "show": true,
                         "total": false,
                         "values": false
                      },
                      "lines": true,
                      "linewidth": 1,
                      "links": [ ],
                      "nullPointMode": "null as zero",
                      "percentage": false,
                      "pointradius": 5,
                      "points": false,
                      "renderer": "flot",
                      "seriesOverrides": [ ],
                      "spaceLength": 10,
                      "span": 12,
                      "stack": false,
                      "steppedLine": false,
                      "styles": [
                         {
                            "alias": "Time",
                            "dateFormat": "YYYY-MM-DD HH:mm:ss",
                            "pattern": "Time",
                            "type": "hidden"
                         },
                         {
                            "alias": "Count",
                            "colorMode": null,
                            "colors": [ ],
                            "dateFormat": "YYYY-MM-DD HH:mm:ss",
                            "decimals": 2,
                            "link": false,
                            "linkTargetBlank": false,
                            "linkTooltip": "Drill down",
                            "linkUrl": "",
                            "pattern": "Value #A",
                            "thresholds": [ ],
                            "type": "hidden",
                            "unit": "short"
                         },
                         {
                            "alias": "Uptime",
                            "colorMode": null,
                            "colors": [ ],
                            "dateFormat": "YYYY-MM-DD HH:mm:ss",
                            "decimals": 2,
                            "link": false,
                            "linkTargetBlank": false,
                            "linkTooltip": "Drill down",
                            "linkUrl": "",
                            "pattern": "Value #B",
                            "thresholds": [ ],
                            "type": "number",
                            "unit": "dtdurations"
                         },
                         {
                            "alias": "Instance",
                            "colorMode": null,
                            "colors": [ ],
                            "dateFormat": "YYYY-MM-DD HH:mm:ss",
                            "decimals": 2,
                            "link": false,
                            "linkTargetBlank": false,
                            "linkTooltip": "Drill down",
                            "linkUrl": "",
                            "pattern": "instance",
                            "thresholds": [ ],
                            "type": "number",
                            "unit": "short"
                         },
                         {
                            "alias": "Job",
                            "colorMode": null,
                            "colors": [ ],
                            "dateFormat": "YYYY-MM-DD HH:mm:ss",
                            "decimals": 2,
                            "link": false,
                            "linkTargetBlank": false,
                            "linkTooltip": "Drill down",
                            "linkUrl": "",
                            "pattern": "job",
                            "thresholds": [ ],
                            "type": "number",
                            "unit": "short"
                         },
                         {
                            "alias": "Version",
                            "colorMode": null,
                            "colors": [ ],
                            "dateFormat": "YYYY-MM-DD HH:mm:ss",
                            "decimals": 2,
                            "link": false,
                            "linkTargetBlank": false,
                            "linkTooltip": "Drill down",
                            "linkUrl": "",
                            "pattern": "version",
                            "thresholds": [ ],
                            "type": "number",
                            "unit": "short"
                         },
                         {
                            "alias": "",
                            "colorMode": null,
                            "colors": [ ],
                            "dateFormat": "YYYY-MM-DD HH:mm:ss",
                            "decimals": 2,
                            "pattern": "/.*/",
                            "thresholds": [ ],
                            "type": "string",
                            "unit": "short"
                         }
                      ],
                      "targets": [
                         {
                            "expr": "count by (job, instance, version) (memcached_version{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\"})",
                            "format": "table",
                            "instant": true,
                            "legendFormat": "",
                            "refId": "A"
                         },
                         {
                            "expr": "max by (job, instance) (memcached_uptime_seconds{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\"})",
                            "format": "table",
                            "instant": true,
                            "legendFormat": "",
                            "refId": "B"
                         }
                      ],
                      "thresholds": [ ],
                      "timeFrom": null,
                      "timeShift": null,
                      "title": "Memcached Info",
                      "tooltip": {
                         "shared": true,
                         "sort": 2,
                         "value_type": "individual"
                      },
                      "transform": "table",
                      "type": "table",
                      "xaxis": {
                         "buckets": null,
                         "mode": "time",
                         "name": null,
                         "show": true,
                         "values": [ ]
                      },
                      "yaxes": [
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": 0,
                            "show": true
                         },
                         {
                            "format": "short",
                            "label": null,
                            "logBase": 1,
                            "max": null,
                            "min": null,
                            "show": false
                         }
                      ]
                   }
                ],
                "repeat": null,
                "repeatIteration": null,
                "repeatRowId": null,
                "showTitle": true,
                "title": "Memcached Info",
                "titleSize": "h6"
             }
          ],
          "schemaVersion": 14,
          "style": "dark",
          "tags": [ ],
          "templating": {
             "list": [
                {
                   "current": {
                      "text": "default",
                      "value": "default"
                   },
                   "hide": 0,
                   "label": "Data source",
                   "name": "datasource",
                   "options": [ ],
                   "query": "prometheus",
                   "refresh": 1,
                   "regex": "",
                   "type": "datasource"
                },
                {
                   "allValue": ".*",
                   "current": {
                      "selected": true,
                      "text": "All",
                      "value": "$__all"
                   },
                   "datasource": "$datasource",
                   "hide": 0,
                   "includeAll": true,
                   "label": "cluster",
                   "multi": true,
                   "name": "cluster",
                   "options": [ ],
                   "query": "label_values(memcached_commands_total, cluster)",
                   "refresh": 1,
                   "regex": "",
                   "sort": 2,
                   "tagValuesQuery": "",
                   "tags": [ ],
                   "tagsQuery": "",
                   "type": "query",
                   "useTags": false
                },
                {
                   "allValue": ".+",
                   "current": {
                      "selected": true,
                      "text": "All",
                      "value": "$__all"
                   },
                   "datasource": "$datasource",
                   "hide": 0,
                   "includeAll": true,
                   "label": "job",
                   "multi": true,
                   "name": "job",
                   "options": [ ],
                   "query": "label_values(memcached_commands_total{cluster=~\"$cluster\"}, job)",
                   "refresh": 1,
                   "regex": "",
                   "sort": 2,
                   "tagValuesQuery": "",
                   "tags": [ ],
                   "tagsQuery": "",
                   "type": "query",
                   "useTags": false
                },
                {
                   "allValue": ".+",
                   "current": {
                      "selected": true,
                      "text": "All",
                      "value": "$__all"
                   },
                   "datasource": "$datasource",
                   "hide": 0,
                   "includeAll": true,
                   "label": "instance",
                   "multi": true,
                   "name": "instance",
                   "options": [ ],
                   "query": "label_values(memcached_commands_total{cluster=~\"$cluster\",job=~\"$job\"}, instance)",
                   "refresh": 1,
                   "regex": "",
                   "sort": 2,
                   "tagValuesQuery": "",
                   "tags": [ ],
                   "tagsQuery": "",
                   "type": "query",
                   "useTags": false
                }
             ]
          },
          "time": {
             "from": "now-1h",
             "to": "now"
          },
          "timepicker": {
             "refresh_intervals": [
                "5s",
                "10s",
                "30s",
                "1m",
                "5m",
                "15m",
                "30m",
                "1h",
                "2h",
                "1d"
             ],
             "time_options": [
                "5m",
                "15m",
                "1h",
                "6h",
                "12h",
                "24h",
                "2d",
                "7d",
                "30d"
             ]
          },
          "timezone": "utc",
          "title": "Memcached Overview",
          "uid": "124d5222454213f748dbfaf69b77ec48",
          "version": 0
       }
kind: ConfigMap
metadata:
  annotations:
    grafana_dashboard_folder: /dashboards/memcached-mixin
  labels:
    grafana_dashboard: "1"
  name: memcached-overview.json
  namespace: monitoring-system
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app.kubernetes.io/instance: memcached
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: memcached
    app.kubernetes.io/version: 1.6.29
    helm.sh/chart: memcached-7.4.11
  name: memcached
  namespace: memcached-system
spec:
  ports:
  - name: memcache
    nodePort: null
    port: 11211
    targetPort: memcache
  selector:
    app.kubernetes.io/instance: memcached
    app.kubernetes.io/name: memcached
  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: memcached
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: memcached
    app.kubernetes.io/version: 1.6.29
    helm.sh/chart: memcached-7.4.11
  name: memcached
  namespace: memcached-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: memcached
      app.kubernetes.io/name: memcached
  strategy:
    rollingUpdate: {}
    type: RollingUpdate
  template:
    metadata:
      annotations:
        logs.grafana.com/scrape: "true"
      labels:
        app.kubernetes.io/instance: memcached
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: memcached
        app.kubernetes.io/version: 1.6.29
        helm.sh/chart: memcached-7.4.11
    spec:
      affinity:
        nodeAffinity: null
        podAffinity: null
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchLabels:
                  app.kubernetes.io/instance: memcached
                  app.kubernetes.io/name: memcached
              topologyKey: kubernetes.io/hostname
            weight: 1
      automountServiceAccountToken: false
      containers:
      - env:
        - name: BITNAMI_DEBUG
          value: "false"
        - name: MEMCACHED_PORT_NUMBER
          value: "11211"
        image: docker.io/bitnami/memcached:1.6.29-debian-12-r4
        imagePullPolicy: IfNotPresent
        livenessProbe:
          exec:
            command:
            - pgrep
            - memcached
          failureThreshold: 6
          initialDelaySeconds: 30
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        name: memcached
        ports:
        - containerPort: 11211
          name: memcache
        readinessProbe:
          failureThreshold: 6
          initialDelaySeconds: 5
          periodSeconds: 5
          successThreshold: 1
          tcpSocket:
            port: memcache
          timeoutSeconds: 3
        resources:
          limits:
            cpu: 999m
            memory: 320Mi
          requests:
            cpu: 50m
            memory: 64Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 1001
          runAsNonRoot: true
          runAsUser: 1001
          seLinuxOptions: {}
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /opt/bitnami/memcached/conf
          name: empty-dir
          subPath: app-conf-dir
        - mountPath: /tmp
          name: empty-dir
          subPath: tmp-dir
      enableServiceLinks: true
      securityContext:
        fsGroup: 1001
        fsGroupChangePolicy: Always
        supplementalGroups: []
        sysctls: []
      serviceAccountName: memcached
      volumes:
      - emptyDir: {}
        name: empty-dir
---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  labels:
    app.kubernetes.io/instance: memcached
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: memcached
    app.kubernetes.io/version: 1.6.29
    helm.sh/chart: memcached-7.4.11
  name: memcached
  namespace: memcached-system
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: memcached
      app.kubernetes.io/name: memcached
---
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: memcached-mixin-alerts
  namespace: monitoring-system
spec:
  groups:
  - name: memcached
    rules:
    - alert: MemcachedDown
      annotations:
        description: Memcached instance {{ $labels.job }} / {{ $labels.instance }}
          is down for more than 15 minutes.
        summary: Memcached instance is down.
      expr: |
        memcached_up == 0
      for: 15m
      labels:
        severity: critical
    - alert: MemcachedConnectionLimitApproaching
      annotations:
        description: Memcached instance {{ $labels.job }} / {{ $labels.instance }}
          connection usage is at {{ printf "%0.0f" $value }}% for at least 15 minutes.
        summary: Memcached max connection limit is approaching.
      expr: |
        (memcached_current_connections / memcached_max_connections * 100) > 80
      for: 15m
      labels:
        severity: warning
    - alert: MemcachedConnectionLimitApproaching
      annotations:
        description: Memcached instance {{ $labels.job }} / {{ $labels.instance }}
          connection usage is at {{ printf "%0.0f" $value }}% for at least 15 minutes.
        summary: Memcached connections at critical level.
      expr: |
        (memcached_current_connections / memcached_max_connections * 100) > 95
      for: 15m
      labels:
        severity: critical
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  labels:
    app.kubernetes.io/instance: memcached
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: memcached
    app.kubernetes.io/version: 1.6.29
    helm.sh/chart: memcached-7.4.11
  name: memcached
  namespace: memcached-system
spec:
  egress:
  - {}
  ingress:
  - ports:
    - port: 11211
  podSelector:
    matchLabels:
      app.kubernetes.io/instance: memcached
      app.kubernetes.io/managed-by: Helm
      app.kubernetes.io/name: memcached
      app.kubernetes.io/version: 1.6.29
      helm.sh/chart: memcached-7.4.11
  policyTypes:
  - Ingress
  - Egress
